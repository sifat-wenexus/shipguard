var CartAPI=function(d){"use strict";var j=Object.defineProperty;var E=(d,o,f)=>o in d?j(d,o,{enumerable:!0,configurable:!0,writable:!0,value:f}):d[o]=f;var l=(d,o,f)=>(E(d,typeof o!="symbol"?o+"":o,f),f);var S,v,I,q,L,O;function o(y,s){const t=f();return o=function(e,x){return e=e-492,t[e]},o(y,s)}function f(){const y=["request","load","addEventListener","before","/cart/update","5OfnoHH","from","775230CbohlB","toString","json","then","http://","delete","length","open","/cart/add","POST","after","append","wenexus-cart-response-","3bRnzrD","2119887FEmoMJ","removeListener","string","get","fetch","779290UZDhVk","add","some","detail","notifyListeners","186743OkrYQW","156104MQxkEs","variant_id","runQueue","startsWith","cart","running","payload","queue","error","remove","application/json","fetchFn","afterListeners","waitForResponse","update","removeEventListener","getItem","77ASrcBN","wenexus-cart-queue",".js","parse","stringify","size","440980tAquEn","setItem","call","random","Recovered from lost cart updates","items","slice","listeners","location","beforeListeners","/cart/clear","api","getCartEndpoint","type","/cart/","instance","https://","117902ymzhIr","pathname","/cart/change","9PrIIAj"];return f=function(){return y},f()}const n=o;(function(y,s){const t=o,e=y();for(;;)try{if(-parseInt(t(506))/1+-parseInt(t(547))/2*(-parseInt(t(495))/3)+-parseInt(t(530))/4*(parseInt(t(556))/5)+parseInt(t(558))/6+-parseInt(t(496))/7+-parseInt(t(507))/8*(-parseInt(t(550))/9)+-parseInt(t(501))/10*(-parseInt(t(524))/11)===s)break;e.push(e.shift())}catch{e.push(e.shift())}})(f,153343);const p=class p extends XMLHttpRequest{static[(S=n(539),v=n(519),n(553))](s,t,e=!0){const x=n;e?this[x(539)][s][x(502)](t):this[x(519)][s][x(502)](t)}static[n(522)](s,t,e=!0){const x=n;e?this[x(539)][s][x(563)](t):this[x(519)][s][x(563)](t)}[n(565)](s,t,e=!0,x,r){const i=n;for(const a of p[i(539)][i(565)])a(this,s,t,e,x,r);super.open(s,t,e,x,r);for(const a of p[i(519)][i(565)])a(this,s,t,e,x,r)}};l(p,S,{open:new Set}),l(p,v,{open:new Set});let g=p;const w=class w{constructor(s){l(this,"queue",new Set);l(this,q,{before:new Set,after:new Set});l(this,L,null);l(this,O,null);const t=n;if(this[t(518)]=s,!w[t(545)])w[t(545)]=this;else return w.instance;const e=async(r,i)=>{const a=t,c=typeof r===a(498)||r instanceof URL?r[a(559)]():r.url,u=this[a(542)](c);if(u){const h=s(r,i);this[a(505)](u,h);const m=await h;return await this[a(505)](u),m}return s(r,i)};window[t(500)]=e,window.XMLHttpRequest=g,g[t(553)](t(565),(r,i,a)=>{const c=t,u=this[c(542)](a);if(u){const h=new Promise((m,N)=>{const b=c;r[b(553)](b(552),()=>{const J=b;m(void 0),this[J(505)](u)}),r[b(553)](b(515),N)});this[c(505)](u,h)}},!0);const x=localStorage[t(523)](t(525));x&&(this[t(514)]=new Set(JSON[t(527)](x))),this[t(509)](this[t(514)][t(529)]>0),window[t(553)]("beforeunload",r=>{if(this[t(514)].size>0)return r.preventDefault(),"Cart updates are still in progress. Are you sure you want to leave?"})}addListener(s,t=!1){const e=n;return this[e(537)][e(t?554:492)][e(502)](s),()=>{this.removeListener(s,t)}}[(I=n(545),q=n(537),L=n(512),O=n(511),n(497))](s,t=!1){const e=n;this[e(537)][t?"before":e(492)].delete(s)}async[n(499)](s=!1){const t=n;if(this[t(511)]&&!s)return this[t(511)];const e=await fetch("/cart.js"),x=await e[t(560)]();return this[t(511)]=x,x}async[n(521)](s,t=!0){const e=n,{cart:x}=await this[e(551)](e(521),{updates:s},t);return x}async[n(493)](s,t=!0){const e=n,{cart:x}=await this.request(e(502),{items:s},t);return x}async[n(516)](s,t=!0){const e=n,x=s.filter(i=>{var a;return(a=this[e(511)])==null?void 0:a[e(535)][e(503)](c=>c[e(508)]===i)});if(!x[e(564)])return await this[e(499)]();const{cart:r}=await this[e(551)](e(521),{updates:x.reduce((i,a)=>({...i,[a]:0}),{})},t);return r}[n(542)](s){const t=n,e=typeof s===t(498)?s:s[t(559)](),x=new URL(!e[t(510)](t(562))||!e.startsWith(t(546))?window[t(538)].origin+"/"+e:e),r={add:t(566),update:t(555),change:t(549),clear:t(540)};for(const i in r){const a=r[i];if([a,a+t(526)].some(c=>x[t(548)].endsWith(c)))return i}return null}async[n(505)](s,t){const e=n,x=this.cart;if(t){for(const a of this[e(537)][e(554)])a(x??await this.get(!0),{requestType:s,updatedBy:"api"},()=>new Promise(c=>{const u=()=>{const h=o;if(this.queue[h(529)]>0||this.running)return setTimeout(u,800);c(t[h(561)](()=>this[h(499)](!0)))};setTimeout(u,800)}));await t;const i=await this[e(499)](!0);return JSON[e(528)](x,null,0)===JSON.stringify(i,null,0)?x:i}const r=await this.get(!0);if(JSON.stringify(x,null,0)===JSON[e(528)](r,null,0))return x;for(const i of this[e(537)][e(492)])i(r,{requestType:s,updatedBy:e(541)});return r}async[n(509)](s=!1){const t=n;if(!this[t(512)]){for(const e of this[t(514)]){this.running=e,this[t(514)][t(563)](e),localStorage[t(531)](t(525),JSON[t(528)](Array[t(557)](this[t(514)])));const x=await this[t(518)][t(532)](window,t(544)+e[t(543)]+".js",{method:t(567),headers:e[t(513)]?{"Content-Type":t(517)}:void 0,body:e[t(513)]?JSON[t(528)](e[t(513)]):void 0});window.dispatchEvent(new CustomEvent(t(494)+e.id,{detail:x}))}this.running=null,s&&(alert(t(534)),this[t(505)]("add")),this[t(514)].size>0&&setTimeout(()=>this[t(509)](),10)}}[n(520)](s){return new Promise(t=>{const e=o;window[e(553)]("wenexus-cart-response-"+s,x=>t(x[e(504)]))})}async request(s,t,e=!0){const x=n,r=Math[x(533)]()[x(559)](36)[x(536)](2)+Date.now()[x(559)](36);this[x(514)][x(502)]({id:r,type:s,payload:t,trigger:e}),localStorage[x(531)](x(525),JSON.stringify(Array[x(557)](this[x(514)]))),this[x(509)]();const i=await this[x(520)](r);return e?{cart:await this[x(505)](s),response:await i.json()}:{cart:await this[x(499)](!e),response:await i[x(560)]()}}};l(w,I);let _=w;return window.weNexusCartApi=new _(fetch),d.CartApi=_,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),d}({});
