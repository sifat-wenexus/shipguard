var D=Object.defineProperty;var U=(g,p,w)=>p in g?D(g,p,{enumerable:!0,configurable:!0,writable:!0,value:w}):g[p]=w;var h=(g,p,w)=>(U(g,typeof p!="symbol"?p+"":p,w),w);(function(){"use strict";const y=class y{constructor(i,e){h(this,"variantIds",new Set);h(this,"variants",{});h(this,"prices",[]);return this.percentage=i,this.enabled=e,y.instance&&(y.instance=this),y.instance}get highestPrice(){return this.prices[this.prices.length-1]}get lowestPrice(){return this.prices[0]}setVariants(i){this.prices.length=0,this.variantIds.clear();for(const e of Object.keys(this.variants))delete this.variants[e];this.prices.push(...Object.keys(i).map(Number).sort((e,n)=>e-n));for(const e of Object.keys(i))this.variants[e]=i[e],this.variantIds.add(i[e])}async getNonPackageProtectionItems(){return(await window.weNexusCartApi.get()).items.filter(e=>!this.variantIds.has(e.variant_id))}async getPackageProtectionItems(){return(await window.weNexusCartApi.get()).items.filter(e=>this.variantIds.has(e.variant_id))}async calculate(){if(this.prices.length===0)throw new Error("No variants have been set");const i=await this.getNonPackageProtectionItems(),e=window.WeNexusOverallPackageProtectionSettings.packageProtectionProductAndVariants.map(o=>o.excludedPackageProtectionVariants.map(d=>Number(d.id.replace("gid://shopify/ProductVariant/","")))).flat(),l=(()=>{const o=[];for(let d=0;d<i.length;d++){const c=i[d].variant_id;e.includes(c)||o.push(i[d])}return o})().reduce((o,d)=>o+d.final_line_price,0)/100;let t=this.lowestPrice.toFixed(2),a=l/100*this.percentage;if(a<=this.highestPrice&&a>=this.lowestPrice){for(const o of this.prices)if(o>a){t=o.toFixed(2);break}}else a>this.highestPrice?t=this.highestPrice.toFixed(2):a<this.lowestPrice&&(t=this.lowestPrice.toFixed(2));return{actualPrice:Number(a.toFixed(2)),variantId:this.variants[t],coercedPrice:t,forPrice:l}}async add(){if((await this.getPackageProtectionItems()).length>0)return;const{variantId:e}=await this.calculate();return(await window.weNexusCartApi.prepend([{id:e,quantity:1}],!1)).items.find(r=>r.variant_id===e)}async remove(){if(this.prices.length===0)throw new Error("No variants have been set");const i=await this.getPackageProtectionItems();if(i.length!==0)return await window.weNexusCartApi.remove(i.map(e=>e.variant_id),!1),i[0]}async change(i){if(this.prices.length===0)throw new Error("No variants have been set");const[e]=await this.getPackageProtectionItems();if(!e||i===e.variant_id)return;const r=(await this.getNonPackageProtectionItems()).map(t=>{var a;return{id:t.variant_id,quantity:t.quantity,selling_plan:(a=t.selling_plan)==null?void 0:a.id,properties:t.properties}}).reverse();return r.unshift({id:i,quantity:1}),(await window.weNexusCartApi.replace(r,!1)).items.find(t=>t.variant_id===i)}async refresh(){var l;const i=await this.getNonPackageProtectionItems();if(!this.enabled||i.length===0)return this.remove();const e=await this.getPackageProtectionItems(),n=(await window.weNexusCartApi.get()).items;if(((l=e[0])==null?void 0:l.quantity)===0||e.length===0)return this.add();const{variantId:r}=await this.calculate();if(e.reduce((t,a)=>t+a.quantity,0)>1){const t=n.find(a=>a.id===r);t&&await window.weNexusCartApi.update({[t.id]:1}),await location.reload()}if(e.some(t=>t.variant_id===r)){const{items:t}=await window.weNexusCartApi.get();return t.findIndex(d=>d.variant_id===r)===t.length-1?void 0:(await window.weNexusCartApi.move(r,0,!1)).items[t.length-1]}return this.change(r)}};h(y,"instance");let g=y;class p{constructor(i){h(this,"thumbnail","https://cdn.shopify.com/s/files/1/1652/8827/files/g4990.png?v=1708754054");h(this,"infoPageLink","/pages/package-protection");h(this,"container",null);h(this,"title","package title");h(this,"enabledDescription","enabled description");h(this,"disabledDescription","disabled description");h(this,"buttonColor","#22c55e");h(this,"checked",!1);h(this,"css","");this.api=i}formatPrice(i,e){return console.log("base class"),new Intl.NumberFormat("en-US",{style:"currency",maximumFractionDigits:2,minimumFractionDigits:2,currency:e}).format(i)}async getPrice(){const{coercedPrice:i}=await this.api.calculate(),e=await window.weNexusCartApi.get();return this.formatPrice(Number(i),e.currency)}async getDescription(){return`${this.checked?this.enabledDescription:this.disabledDescription}`}async getCheckboxContainer(i){this.checked=i;const e=document.createElement("div"),n=await this.getPrice(),r=await this.getDescription();e.insertAdjacentHTML("afterbegin",`
      <style>${this.css}</style>
        <div class="wenexus-package-protection__content">
            <div class="wenexus-package-protection__image">
                <img src="${this.thumbnail}" alt="Package Protection" />
            </div>
            <div class="wenexus-package-protection__desc">
                <h5>${this.title} <a href="${this.infoPageLink}" target="_blank">â“˜</a></h5>
                <p> <span class="wenexus-package-protection-description">${r} </span><strong class="protection-price">${n}</strong></p>
            </div>
        </div>
        <div class="wenexus-package-protection__toggle" >
        <div style="position:relative;">
            <input type="checkbox" ${i?"checked":""} style="position:absolute; width:100%; height:100%; left:0; z-index:99; opacity:0">

            <div class="toggle-container" style="display: flex;  width: 4rem; height: 1.75rem; background-color: ${i?this.buttonColor:"#7b7b7b"}; position: relative; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); border-radius: 9999px; cursor: pointer; transition: background-color 0.5s ease-out;">
                <span class="toggle-switch" style="height: 1.25rem; width: 1.25rem; position: absolute; top: 0.25rem; left: 0.25rem; background-color: white; border-radius: 9999px; ${i?"transform: translateX(2rem);":""} transition: transform 0.3s ease-out; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); display: flex; align-items: center; justify-content: center;"></span>
            </div>
            </div>
        </div>
      `);const l=e.querySelector(".wenexus-package-protection__toggle input"),t=e.querySelector(".toggle-container"),a=e.querySelector(".toggle-switch");e.className="wenexus-package-protection",l.addEventListener("click",()=>{o(),this.checked=l.checked});const o=()=>{t.style.backgroundColor=l.checked?this.buttonColor:"#7b7b7b",a.style.transform=l.checked?"translateX(2rem)":"translateX(0)"};return o(),this.container=e,{container:e,checkbox:l}}async getStyleMarkup({accentColor:i,imageWidth:e=56,containerGap:n=[0,10],contentGap:r=[0,10],descriptionFontWeight:l="bold",descriptionFontSize:t=.8,descriptionMargin:a=[0,0,0,0],titleFontSize:o=1.4,hideDescriptionPage:d=!0,containerMargin:c=[0,0,8,0],containerJustify:m="end",extraStyles:f=""}){return`
      <style>
         .wenexus-package-protection {
            display: flex;
            justify-content: ${m};
            align-items: center;
            margin: ${c==null?void 0:c.join("px ")};
            gap: ${n[0]} ${n[1]}px;
         }
         
         .wenexus-package-protection__content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: ${r[0]} ${r[1]}px;
         }
         
         .wenexus-package-protection__image {
            max-width: ${e}px;
         }
         
         .wenexus-package-protection__image img {
            width: 100%;
         }
         
         .wenexus-package-protection__desc h5 {
            font-size: ${o}rem;
            margin: 0;
         }
         
         .wenexus-package-protection__desc p {
            font-size: ${t}rem;
            font-weight: ${l};
            margin: ${a==null?void 0:a.join("px ")}px;
         }
         
         .wenexus-package-protection__desc a {
            text-decoration: none;
            font-size: 1.5rem;
            outline: 0;
            color: #222;
            transition: .3s;
            ${d?"display: none;":""}
         }
         
         .wenexus-package-protection__toggle {
            accent-color: ${i} !important;
            zoom: 1.55;
         }
         
         ${f}
      </style>`}getInsertionPointSelectors(){return[{selector:'button[type="submit"][name="checkout"]',insertPosition:"before"}]}refreshUI(i){location.reload()}async refreshPriceUI(){this.container&&(this.container.querySelector(".protection-price").textContent=await this.getPrice())}}class w extends p{constructor(){super(...arguments);h(this,"thumbnail","https://cdn.shopify.com/s/files/1/0010/3134/0085/files/pp-caliconnected.png?v=1716625753")}static shouldUse(){var e;return console.log("Enterprise"),((e=window.Shopify.theme)==null?void 0:e.name)==="Enterprise"}getBoundaryParent(e){if(e.boundaryParents)return e;const n=document.querySelectorAll(e.selector),r=new Set;for(const l of n){let t=l.parentElement;for(;!(!t||t.tagName==="CART-DRAWER");)t=t.parentElement;r.add(t??document.body)}return r.size===0&&r.add(document.body),e.boundaryParents=r,e}getInsertionPointSelectors(){return[{selector:'button[name="checkout"]',insertPosition:"before"}].map(n=>this.getBoundaryParent(n))}async getStyleMarkup(e){return super.getStyleMarkup({imageWidth:66,containerMargin:[10,0,12,0],containerJustify:"space-between",titleFontSize:1.8,descriptionFontSize:1.1,hideDescriptionPage:!1,descriptionMargin:[2,0,0,0],...e,accentColor:"#2c7e3f"})}async refreshUI(){var e;(e=document.getElementById("cart-items"))==null||e.refresh(),await this.refreshPriceUI()}}class $ extends p{constructor(){super(...arguments);h(this,"thumbnail","https://cdn.shopify.com/s/files/1/0010/3134/0085/files/pp-caliconnected.png?v=1716625753")}static shouldUse(){var e,n,r,l,t,a,o,d,c,m,f,I,x;return console.log("shopify free theme"),((e=window.Shopify.theme)==null?void 0:e.theme_store_id)===887||((n=window.Shopify.theme)==null?void 0:n.theme_store_id)===1891||((r=window.Shopify.theme)==null?void 0:r.theme_store_id)===1567||((l=window.Shopify.theme)==null?void 0:l.theme_store_id)===1368||((t=window.Shopify.theme)==null?void 0:t.theme_store_id)===1356||((a=window.Shopify.theme)==null?void 0:a.theme_store_id)===1864||((o=window.Shopify.theme)==null?void 0:o.theme_store_id)===1841||((d=window.Shopify.theme)==null?void 0:d.theme_store_id)===1499||((c=window.Shopify.theme)==null?void 0:c.theme_store_id)===1500||((m=window.Shopify.theme)==null?void 0:m.theme_store_id)===1431||((f=window.Shopify.theme)==null?void 0:f.theme_store_id)===1434||((I=window.Shopify.theme)==null?void 0:I.theme_store_id)===1363||((x=window.Shopify.theme)==null?void 0:x.theme_store_id)===2699}getInsertionPointSelectors(e,n){return[{selector:n??".cart__ctas",insertPosition:e??"before",boundaryParents:new Set([document.body])}]}async getStyleMarkup(e){return super.getStyleMarkup({imageWidth:66,containerMargin:[10,0,12,0],containerJustify:"space-between",titleFontSize:1.8,descriptionFontSize:1.1,hideDescriptionPage:!1,descriptionMargin:[2,0,0,0],...e,accentColor:"#2c7e3f"})}async refreshUI(){Array.from(document.getElementsByTagName("cart-items")).forEach(a=>a.onCartUpdate()),await this.refreshPriceUI();let e=document.getElementsByClassName("totals__total-value");const n=await window.weNexusCartApi.get();if(n.total_price===0){await location.reload();return}Array.from(e).forEach(a=>a.innerHTML=`${this.formatPrice(Number(n.total_price/100),n.currency)} USD`);let r=document.getElementsByClassName("cart-count-bubble");Array.from(r).forEach(a=>a.innerHTML=n.item_count.toString());const l=await this.getDescription(),t=document.getElementsByClassName("wenexus-package-protection-description");Array.from(t).forEach(a=>a.innerHTML=`${l} `),setTimeout(()=>{Array.from(document.getElementsByTagName("a")).filter(o=>o.href.includes(n.items[n.items.length-1].variant_id.toString())).forEach(o=>o.setAttribute("href","#"))},1e3)}}async function C(){var x,E;const i=[$,w,p].find(s=>s.shouldUse?s.shouldUse():!0);if(!i)return console.error("No package protection client found");const e=(await window.weNexusCartApi.get()).items,n=window.WeNexusOverallPackageProtectionSettings,r=window.WeNexusOverallPackageProtectionSettings.packageProtectionProductAndVariants.map(s=>s.excludedPackageProtectionVariants.map(u=>Number(u.id.replace("gid://shopify/ProductVariant/","")))).flat(),t=(()=>{const s=[];for(let u=0;u<e.length;u++){const b=e[u].variant_id;r.includes(b)||e[u].vendor!=="OverallInsurance"&&s.push(e[u])}return s})();console.log("variants",t);const a=n.insuranceDisplayButton??!0,o=()=>{const s=localStorage.getItem("package-protection-enabled");return t.length>0&&s==="false"?!0:s===null||s==="false"?!1:s===null?a:s==="true"},d=new g(Number(n.percentage),o()),c=new i(d);let m=[];n.defaultSetting?m=((E=c.getInsertionPointSelectors)==null?void 0:E.call(c,"before"))||[]:m=((x=c.getInsertionPointSelectors)==null?void 0:x.call(c,n.position.toLowerCase()??"before",n.cssSelector))||[];async function f(s=!1){const u=await d.refresh(),b=localStorage.getItem("package-protection-item")||null,P=(u==null?void 0:u.variant_id.toString())||null;localStorage.setItem("package-protection-item",(u==null?void 0:u.variant_id.toString())??""),b===P&&u&&c.refreshUI(u??null),(s||b!==P)&&c.refreshUI(u??null)}d.setVariants(n.productVariants.reduce((s,u)=>(s[u.price]=Number(u.id),s),{})),c.thumbnail=n.iconUrl,c.title=n.title,c.enabledDescription=n.enabledDescription,c.disabledDescription=n.disabledDescription,c.buttonColor=n.switchColor,c.css=n.css,window.weNexusCartApi.addListener(()=>f()),typeof c.getStyleMarkup=="function"&&document.head.insertAdjacentHTML("beforeend",await c.getStyleMarkup({accentColor:"#52c939",imageWidth:48}));for(const s of m){if(s.shouldUse&&!s.shouldUse())continue;new window.WeNexusQuerySelectorLive(s.selector,s.boundaryParents).addListener(async b=>{var P;for(const v of b){const{container:_,checkbox:k}=await c.getCheckboxContainer(t.length>0?o():!1);if(console.log(k.checked,"enabled",o()),!k.checked&&t.length==0){localStorage.setItem("package-protection-enabled","false"),await d.remove(),(P=document.getElementsByTagName("cart-items")[0])==null||P.onCartUpdate();continue}else localStorage.setItem("package-protection-enabled","true");switch(s.insertPosition){case"before":v.insertAdjacentElement("beforebegin",_);break;case"after":v.insertAdjacentElement("afterend",_);break;case"inside":v.insertAdjacentElement("afterbegin",_);break;case"replace":v.replaceWith(_);break}k.addEventListener("change",async()=>{localStorage.setItem("package-protection-enabled",k.checked.toString()),d.enabled=o(),k.disabled=!0;const A=document.querySelectorAll('button[name="checkout"]');A.forEach(N=>N.disabled=!0),await f(!0),k.disabled=!1,A.forEach(N=>N.disabled=!1)})}})}Array.from(document.getElementsByTagName("a")).filter(s=>s.href.includes(e[e.length-1].variant_id.toString())).forEach(s=>s.setAttribute("href","#")),await f()}document.readyState!=="complete"?document.addEventListener("readystatechange",()=>{(document.readyState==="interactive"||document.readyState==="complete")&&C()}):C()})();
